import{u as M,r as n,j as s}from"./index-CHS3ffuP.js";import{c as T,g as R,u as A}from"./dateTimeFormater--SVEKv5u.js";import{S as O}from"./index-CD1s_igV.js";import{c as V}from"./calculateIrrSingleInvestment-CXX7Uab2.js";import{g as I}from"./companyService-DGMeZwZc.js";import{g as k}from"./AuthService-CWGUZqPg.js";import{n as B,a as L}from"./investorGrossTotal-oag5Zney.js";import{M as P,a as z}from"./index-CR-UEZqL.js";import"./iconBase-Bv3yHtYe.js";const Z=()=>{const c=M(),[e,p]=n.useState([]),[l,x]=n.useState("desc");n.useEffect(()=>{(async()=>{const a=await R(),r=await Promise.all(a.map(async m=>{const d=await j(m.companyId);return{...m,companyName:d==null?void 0:d.name,profile:d==null?void 0:d.profile}}));p(r)})()},[]);const j=async t=>await I(t),h=()=>{x(a=>a=="asc"?"desc":"asc");const t=[...e].sort((a,r)=>{var m,d;return l==="asc"?(m=a==null?void 0:a.companyName)==null?void 0:m.localeCompare(r==null?void 0:r.companyName):l==="desc"?(d=r==null?void 0:r.companyName)==null?void 0:d.localeCompare(a==null?void 0:a.companyName):0});p(t)};return s.jsx("div",{className:"deals",children:s.jsxs("table",{className:"px-3",children:[s.jsx("thead",{className:"thead-dark",children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col  ",style:{aspectRatio:"1/1"},className:"border-0"}),s.jsxs("th",{scope:"col ",onClick:()=>h(),children:["COMPANY",l==="asc"?s.jsx(P,{size:30}):s.jsx(z,{size:30})]}),s.jsx("th",{scope:"col ",children:"Investor "}),s.jsx("th",{scope:"col ",children:" INVESTMENT DATE"}),s.jsx("th",{scope:"col ",children:" INVESTMENT"}),s.jsx("th",{scope:"col ",children:"NET PROFIT(LOSS)"}),s.jsx("th",{scope:"col ",children:"NET MOIC"}),s.jsx("th",{scope:"col ",children:"NET IRR "}),s.jsx("th",{scope:"col ",className:"border-0",children:"Current Shareholding(%) "}),s.jsx("th",{style:{aspectRatio:"1/1"},className:"border-0"})]})}),s.jsx("tbody",{children:e==null?void 0:e.map((t,a)=>{var r;return(r=t==null?void 0:t.investors)==null?void 0:r.map((m,d)=>s.jsxs("tr",{className:"",children:[s.jsx("td",{children:s.jsx("div",{onClick:()=>c("/admin/companies/new-company",{state:t==null?void 0:t.companyId}),className:" ",style:{aspectRatio:"1/1"},children:s.jsx("img",{className:"w-100 h-100 rounded-circle",src:O+(t==null?void 0:t.profile)||(t==null?void 0:t.img),alt:""})})}),s.jsx("td",{onClick:()=>c("about",{state:t==null?void 0:t.companyId}),className:"text-capitalize cursor-pointer",children:t==null?void 0:t.companyName}),s.jsx(U,{deal:t,investor:m,investDate:t==null?void 0:t.investedDate,companyId:t==null?void 0:t.companyId})]},a))})})]})})},U=({deal:c,investor:e,investDate:p,companyId:l})=>{var g;const[x,j]=n.useState(0),[h,t]=n.useState(0),[a,r]=n.useState(e==null?void 0:e.shareholding),[m,d]=n.useState(0),[W,E]=n.useState(!1),[N,w]=n.useState(0);n.useEffect(()=>{(async()=>{var i;const o=await I(l);w(parseInt((i=o==null?void 0:o.dealSummary)==null?void 0:i.currentValuation))})()},[l]),n.useEffect(()=>{(async()=>{const o=parseFloat((e==null?void 0:e.amount)||0)+parseFloat((e==null?void 0:e.fees)||0),i=parseFloat((e==null?void 0:e.carried)||0),S=parseFloat((e==null?void 0:e.shareholding)||0),y=await B(o,S,N,c.currency,i/100),D=await L(o,S,N,c.currency,i/100),F=V(-1*o,p,o+y,new Date().toLocaleDateString());d(F),j(y==null?void 0:y.toFixed(2)),t(D)})()},[c,e,p,N]);const u=n.useRef();n.useEffect(()=>{const f=o=>{u!=null&&u.current&&!(u!=null&&u.current.contains(o.target))&&E(!1)};return document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[]);const C=async f=>{let o=f.target.value.replace("%","");c.investors.find(i=>(i==null?void 0:i.investerId)===(e==null?void 0:e.investerId)&&(i==null?void 0:i.profit)===(e==null?void 0:e.profit)).shareholding=parseFloat(o||0),r(o),await A(c==null?void 0:c._id,c)};return s.jsxs(s.Fragment,{children:[s.jsx("td",{children:s.jsx(G,{id:e==null?void 0:e.investerId})}),s.jsx("td",{children:p}),s.jsxs("td",{children:[" ",T(e==null?void 0:e.invest,c==null?void 0:c.currency)]}),s.jsx("td",{children:x}),s.jsxs("td",{children:[" ",h&&((g=h==null?void 0:h.toString())==null?void 0:g.substring(0,4))+"x"]}),s.jsx("td",{children:m==null?void 0:m.toFixed(2)}),s.jsx("td",{className:" position-relative text-end",children:s.jsx("div",{className:"d-flex field m-auto  position-absolute d-float",ref:u,children:s.jsx("input",{type:"text",className:"input-field py-2 ",value:a!==""?`${a}%`:"",onChange:C})})}),s.jsx("td",{style:{aspectRatio:"1/1"}})]})},G=({id:c})=>{var l,x;const[e,p]=n.useState(null);return n.useEffect(()=>{c&&(async()=>{const h=await k(c);p(h)})()},[c]),s.jsxs(s.Fragment,{children:[(l=e==null?void 0:e.personal)==null?void 0:l.firstName," ",(x=e==null?void 0:e.personal)==null?void 0:x.lastName]})};export{Z as default};
