import{r as i,j as e,u as O}from"./index---ThxQHl.js";import{b as B,d as M}from"./index-C7djvUer.js";import{B as U}from"./index-C_7aPAX4.js";import{c as v,d as z}from"./dateTimeFormater-DxVYPYlX.js";import{a as P}from"./AuthService-BbqxxGWe.js";import{g as J,u as L,a as X,d as W}from"./companyService-BBubZftP.js";import{a as q,S as G}from"./index-naFqRyV3.js";import{e as H,n as K,a as Q}from"./investorGrossTotal-S4L9jiCN.js";import{c as Y}from"./calculateIrrSingleInvestment-CXX7Uab2.js";import{g as Z}from"./index-DOYYN9hF.js";import"./iconBase-BwtrK68j.js";const ee=({setIsNew:j,companyId:h,reFetch:N})=>{const[a,y]=i.useState({}),[d,g]=i.useState([]),[u,D]=i.useState([]),[c,n]=i.useState({currency:"EUR"}),[x,f]=i.useState(""),[b,A]=i.useState(.94),[V,k]=i.useState(0);i.useEffect(()=>{(async()=>{const r=await J(h);f(r)})()},[h]),i.useEffect(()=>{(async()=>{var o;const{data:r}=await q.get(`https://api.frankfurter.app/latest?from=${c==null?void 0:c.currency}`),p=await H(c==null?void 0:c.currency,a==null?void 0:a.investedDate);k(((o=r==null?void 0:r.rates)==null?void 0:o.EUR)||1),A(p||1)})()},[c==null?void 0:c.currency,a==null?void 0:a.investedDate]),i.useEffect(()=>{(async()=>{const r=await P("CUSTOMER");D(r)})()},[]);const T=()=>{g([...d,{name:"",amount:"",entryFee:"",carried:""}])},$=t=>{const r=d.filter((p,o)=>o!==t);g(r)},S=async(t,r)=>{const{name:p,value:o}=r.target,F=await Promise.all(d.map(async(s,C)=>{if(C===t){const l={...s,[p]:o},m=parseInt(l.amount||0),w=parseFloat(l.entryFee||0),R=parseFloat(l.carried||0),I=parseFloat(l.shareholding||0),E=(m+m*w/100)*b;return l.fees=m*w/100,l.profit=await K((m+m*w/100)*b,I,a==null?void 0:a.currentValue,c==null?void 0:c.currency,R/100),l.moic=await Q((m+m*w/100)*b,I,a==null?void 0:a.currentValue,c==null?void 0:c.currency,R/100),l.irr=Y(-1*E,a==null?void 0:a.investedDate,E+l.profit,new Date().toLocaleDateString()),l}return s}));g(F)},_=async t=>{t.preventDefault();const r=d==null?void 0:d.map((s,C)=>({...s,amount:parseInt((s==null?void 0:s.amount)||0)*b,invest:parseInt((s==null?void 0:s.amount)||0),fees:parseFloat((s==null?void 0:s.fees)||0)*b})),p={...a,currency:c==null?void 0:c.currency,investors:r,companyId:h};let o;!x.dealSummary||!x.dealSummary.investDate?o=a==null?void 0:a.investedDate:o=x==null?void 0:x.dealSummary.investDate,await L(h,{investDate:o,currentValuation:a==null?void 0:a.currentValue}),await z(p)&&(N(),j(!1))};return e.jsx("div",{className:"pop",children:e.jsxs("div",{className:"pop-body col-10 pb-5",children:[e.jsx("div",{className:"text-end",children:e.jsx(U,{onClick:()=>j(t=>!t),className:"cursor-pointer",size:30})}),e.jsx("h5",{className:"text-center mb-4 fs-3 fw-bold",children:"Add a deal"}),e.jsx("form",{onSubmit:_,children:e.jsxs("div",{className:"d-flex flex-column gap-4 col-md-10 mx-auto",children:[e.jsxs("div",{className:"d-flex gap-3 justify-content-end",children:[e.jsxs("div",{children:[e.jsx("div",{children:" old Rate "}),e.jsxs("div",{className:"text-center text-red",children:[b," €"]})]}),e.jsxs("div",{children:[e.jsx("div",{children:" Current Rate "}),e.jsxs("div",{className:"text-center text-success",children:[V," €"]})]})]}),e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"valuation",children:"Current valuation"}),e.jsx("input",{type:"text",name:"valuation",value:a==null?void 0:a.currentValue,onChange:t=>{y({...a,currentValue:t.target.value})},className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Investment date"}),e.jsx("input",{type:"date",name:"date",onChange:t=>y({...a,investedDate:t.target.value}),className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Currency"}),e.jsxs("select",{onChange:t=>n(JSON.parse(t.target.value)),name:"",id:"",className:"input-field",children:[e.jsx("option",{value:JSON.stringify({currency:"EUR"}),children:"Euro"}),e.jsx("option",{value:JSON.stringify({currency:"USD"}),children:"US Dollar"})]})]})]}),d.map((t,r)=>{var p,o,F;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border border-3 p-3 rounded-5 border-secondary position-relative",children:[e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field w-50",children:[e.jsx("label",{htmlFor:`name-${r}`,children:"Select Investors"}),e.jsx("div",{className:"input-field w-100",children:e.jsxs("select",{name:"investerId",value:t.investerId,onChange:s=>S(r,s),style:{outline:"none"},className:"border-0 bg-transparent w-100",children:[e.jsx("option",{value:"",children:"Select Investor"}),(u==null?void 0:u.length)>0&&u.map((s,C)=>{var l,m;return e.jsxs("option",{value:s==null?void 0:s._id,children:[(l=s==null?void 0:s.personal)==null?void 0:l.firstName," ",(m=s==null?void 0:s.personal)==null?void 0:m.lastName]},C)})]})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`amount-${r}`,children:"Amount invested"}),e.jsx("input",{type:"text",name:"amount",value:t.amount,className:"input-field",onChange:s=>S(r,s)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`entryFee-${r}`,children:" Entry Fee (%)"}),e.jsx("input",{type:"text",name:"entryFee",value:t.entryFee,className:"input-field",onChange:s=>S(r,s)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`carried-${r}`,children:"Carried (%)"}),e.jsx("input",{type:"text",name:"carried",value:t.carried,className:"input-field",onChange:s=>S(r,s)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`share-${r}`,children:" Shareholding (%)"}),e.jsx("input",{type:"text",name:"shareholding",value:t.shareholding,className:"input-field",onChange:s=>S(r,s)})]}),e.jsx("div",{className:"d-flex gap-2 mt-auto align-items-center",children:e.jsx("button",{type:"button",style:{width:"50px",aspectRatio:"1/1"},onClick:()=>$(r),className:"btn-gray p-0 rounded-circle position-absolute close-investor",children:e.jsx(U,{size:20})})})]},r),e.jsxs("div",{className:"d-flex gap-4 mt-3",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Amount paid in euro"}),e.jsx("input",{type:"text",value:v((parseInt((t==null?void 0:t.amount)||0)+parseFloat((t==null?void 0:t.fees)||0))*b),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net Profit "}),e.jsx("input",{type:"text",value:v(t==null?void 0:t.profit),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net MOIC"}),e.jsx("input",{type:"text",value:(t==null?void 0:t.moic)&&((o=(p=t==null?void 0:t.moic)==null?void 0:p.toString())==null?void 0:o.substring(0,4)),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net IRR"}),e.jsx("input",{type:"text",value:((F=t==null?void 0:t.irr)==null?void 0:F.toFixed(2))+"%",className:"input-field bg-white border border-2",disabled:!0})]})]})]})})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",className:`btn-${d.length<=0?"red":"gray"} rounded-5 col-5`,onClick:T,children:"Add an investor"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:`btn-${d.length<=0?"gray":"red"} rounded-5 col-5`,children:"Save"})})]})})]})})},ue=()=>{const[j,h]=i.useState(!1),[N,a]=i.useState([]),[y,d]=i.useState(""),g=O(),u=async()=>{const n=await X();a(n)};i.useEffect(()=>{u()},[]);const D=async n=>{a(x=>x.filter(f=>f._id!==n)),await W(n)},c=()=>{u()};return e.jsxs("div",{className:"bg-white company h-100 ",children:[e.jsxs("table",{children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0",scope:"col"}),e.jsx("th",{scope:"col",children:"Name"}),e.jsx("th",{scope:"col",children:"CUMULATED INVESTMENT"}),e.jsx("th",{scope:"col",children:"CURRENT VALUATION "}),e.jsx("th",{scope:"col"}),e.jsx("th",{style:{aspectRatio:"1/1"},className:"border-0"})]})}),e.jsx("tbody",{children:N&&(N==null?void 0:N.map((n,x)=>{var f;return e.jsxs("tr",{className:" ",children:[e.jsx("td",{children:e.jsx("div",{style:{aspectRatio:"1/1"},children:e.jsx("img",{className:"w-100 h-100 rounded-circle",src:G+(n==null?void 0:n.profile),alt:""})})}),e.jsx("td",{className:"text-uppercase ",children:n==null?void 0:n.name}),e.jsx(te,{id:n==null?void 0:n._id}),e.jsx("td",{children:v((f=n==null?void 0:n.dealSummary)==null?void 0:f.currentValuation)}),e.jsx("td",{className:"",children:e.jsxs("div",{className:" create-deal-btn",children:[" ",e.jsx("button",{className:"btn-red",onClick:()=>{h(!j),d(n==null?void 0:n._id)},children:"Create a deal"})]})}),e.jsx("td",{className:"text-end ",children:e.jsx("div",{className:"d-flex gap-4",style:{width:"50px",aspectRatio:"1/1"},children:e.jsx("button",{onClick:()=>g("new-company",{state:n==null?void 0:n._id}),className:"btn text-primary w-100 h-100 cursor-pointer bg-very-light-gray rounded-circle",children:e.jsx(B,{size:20})})})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex gap-4",style:{width:"50px",aspectRatio:"1/1"},children:e.jsx("button",{onClick:()=>D(n==null?void 0:n._id),className:"btn text-danger bg-very-light-gray  w-100 h-100 rounded-circle",children:e.jsx(M,{size:20})})})})]},x)}))})]}),j&&e.jsx(ee,{reFetch:c,companyId:y,setIsNew:h})]})},te=({id:j})=>{const[h,N]=i.useState(0),[a,y]=i.useState(0);return i.useEffect(()=>{(async()=>{const{totalInvestment:g,current:u}=await Z(j);N(g),y(u)})()},[j]),e.jsx(e.Fragment,{children:e.jsxs("td",{children:[" ",v(h)]})})};export{ue as default};
